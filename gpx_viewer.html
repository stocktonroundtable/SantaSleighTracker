<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GPX Route Viewer</title>

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #111;
  }
  #map {
    width: 100%;
    height: 100%;
  }

  /* Soft glow on route */
  .leaflet-overlay-pane svg path {
    filter: drop-shadow(0 0 6px #d31c1c);
  }
</style>
</head>

<body>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet GPX plugin -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>

<script>
(function () {

  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  const fullUrl = getQueryParam("gpx");
  const fileName = getQueryParam("file");

  let gpxUrl = "";

  if (fullUrl) {
    gpxUrl = fullUrl;
  } else if (fileName) {
    gpxUrl =
      "https://raw.githubusercontent.com/BeverleyRoundTable/BRT/main/GPX/" +
      fileName;
  } else {
    alert("No GPX file provided.\n\nUse ?gpx=fullURL or ?file=filename.gpx");
    return;
  }

  const map = L.map("map");

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
  }).addTo(map);

  // --- Custom Bauble Icons (Prevent Squashing) ---
  const startIcon = L.icon({
    iconUrl: "https://i.ibb.co/PzDYmwzZ/Santa-Marker-4.png",
    iconSize: [42, 42],      // Perfect bauble size
    iconAnchor: [21, 38],    // Bottom-middle sits on road
    popupAnchor: [0, -38],
  });

  const endIcon = L.icon({
    iconUrl: "https://i.ibb.co/39WF0kBd/Santa-Marker-5.png",
    iconSize: [42, 42],
    iconAnchor: [21, 38],
    popupAnchor: [0, -38],
  });

  const gpx = new L.GPX(gpxUrl, {
    async: true,
    marker_options: {
      startIcon: startIcon,
      endIcon: endIcon,
      shadowUrl: ""
    },
    polyline_options: {
      color: "#d31c1c",
      weight: 4,
      opacity: 0.95
    }
  })
  .on("loaded", function (e) {
    map.fitBounds(e.target.getBounds());
  })
  .addTo(map);

})();
</script>

</body>
</html>
